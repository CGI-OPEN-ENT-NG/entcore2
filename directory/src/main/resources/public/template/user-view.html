<!--
 view
 -->

<div class="row reduce-block-six twelve-mobile user-infos no-margin">
	<lightbox show="display.login" on-close="display.login = false" workflow="directory.allowLoginUpdate" ng-if="account.id === me.userId">
		<h1><i18n>directory.login.update.title</i18n></h1>
		<form name="loginForm" novalidate>
			<div class="row">
				<p>
					<label translate content="userBook.profile.login" class="two cell twelve-mobile"></label>
					<input type="text" class="ten cell twelve-mobile" ng-pattern="/^[0-9a-z\-\.]+$/" name="newLoginAlias" ng-model="account.newLoginAlias">
				</p>
			</div>

			<div class="row">
				<p class="input-errors small-text" ng-if="loginForm.newLoginAlias.$invalid && loginForm.newLoginAlias.$dirty">
					<span ng-repeat="(key, value) in loginForm.newLoginAlias.$error">
						<span ng-if="value">[[lang.translate(key)]]</span><span ng-if="key == 'pattern'">[[lang.translate('directory.form.login.pattern')]]</span>
					</span>
				</p>
			</div>

			<hr>

			<div class="row">
				<button type="button" class="submit right-magnet cell" ng-click="saveLogin();" ng-disabled="loginForm.newLoginAlias.$invalid || loginForm.newLoginAlias.$pristine "><i18n>directory.save</i18n></button>
				<button type="button" class="cancel right-magnet cell" ng-click="display.login = false;"><i18n>cancel</i18n></button>
			</div>
		</form>
	</lightbox>

	<lightbox show="display.otp" on-close="display.otp = false">
		<h2><i18n>directory.otp.title</i18n></h2>
		<span ng-if="account.otp"><i18n>directory.otp.content</i18n></span>
		<br /><br />
		<span ng-if="account.otp">[[account.otp.login]]</span>
		<br /><br />
		<span ng-if="account.otp"><i18n>directory.otp.info</i18n></span>
	</lightbox>

	<lightbox ng-if="display.editLightbox"
	          ng-switch="display.editLightbox"
			  show="display.editLightbox" on-close="display.editLightbox = ''">
		<h1>
			<i18n ng-switch-when="email">directory.email.update.title</i18n>
			<i18n ng-switch-when="homePhone">directory.telephone.update.title</i18n>
			<i18n ng-switch-when="mobile">directory.mobilePhone.update.title</i18n>
			<i18n ng-switch-default>directory.modify</i18n>
		</h1>

		<form name="editForm" novalidate>
			<div class="row">
				<p>
					<label ng-switch-when="email" class="three cell twelve-mobile"><i18n>userBook.profile.email</i18n></label>
					<input ng-switch-when="email" type="email" name="editFormInput" class="nine cell twelve-mobile" ng-model="boxEdit.value">
					<input ng-switch-when="homePhone|mobile" ng-switch-when-separator="|"
					       type="tel" name="editFormInput" ng-pattern="/^((00|\+)?(?:[0-9] ?-?\.?){6,15})?$/" class="twelve inline-editing" ng-model="boxEdit.value" ng-trim="false"/>
					<input ng-switch-default type="text" name="editFormInput" class="nine cell twelve-mobile" ng-model="boxEdit.value">
				</p>
			</div>

			<div class="row">
				<p class="input-errors small-text"
				   ng-switch-when="email"
				   ng-if="editForm.editFormInput.$invalid && editForm.editFormInput.$dirty">
					<span ng-repeat="(key, value) in editForm.editFormInput.$error">
						<label ng-if="value">[[lang.translate(key)]]</label>
					</span>
				</p>

				<p class="input-errors small-text"
				   ng-switch-when="homePhone|mobile" ng-switch-when-separator="|"
				   ng-if="editForm.editFormInput.$invalid && editForm.editFormInput.$dirty">
					<i18n>pattern</i18n>
				</p>
			</div>

			<hr>

			<div class="row">
				<button type="button" class="submit right-magnet cell" ng-click="saveEditLightbox()" ng-disabled="editForm.$invalid || editForm.$pristine "><i18n>directory.save</i18n></button>
				<button type="button" class="cancel right-magnet cell" ng-click="display.editLightbox = ''"><i18n>cancel</i18n></button>
			</div>
		</form>
	</lightbox>


	<article class="rigid-grid cell twelve">

		<div class="cell four height-four reduce-block-six avatar">
			<div class="fluid twelve cell clip" ng-if="account.edit.userbook">
				<image-select ng-model="account.picture" default="/img/illustrations/no-avatar.svg" thumbnails="[{ width: 381, height: 381 }]" ng-change="saveChanges()"></image-select>
			</div>
			<div class="fluid cell twelve" ng-if="!account.edit.userbook">
				<img ng-src="[[account.picture]]?thumbnail=381x381" ng-if="account.picture" class="absolute" />
				<img skin-src="/img/illustrations/no-avatar.svg" ng-if="!account.picture" class="absolute" />
			</div>
		</div>

		<div>
			<h2 class="text-word-break no-margin size-auto">[[account.displayName]]</h2>
			<div class="flex-row">
				<span class="cell circle square-mini top-spacing-small right-spacing-small" ng-class="account.getProfile()"></span>
				<span class="cell low-importance">[[ account.getProfileName() ]]</span>
			</div>
		</div>

		<form class="sheet small-text top-spacing-twice" name="userForm" novalidate>

			<div class="row">
				<div class="four cell">
					<i18n>userBook.profile.login</i18n>
				</div>
				<em class="seven cell">
					[[ (account.loginAlias && account.loginAlias != '') ? account.loginAlias : account.login ]]
					<a ng-click="display.login = true; account.newLoginAlias = account.loginAlias;" workflow="directory.allowLoginUpdate">
						<i18n>directory.login.update.button</i18n>
					</a>
				</em>
			</div>

			<div class="row" ng-if="displayPassword(account,me)">
				<div class="four cell">
					<i18n>userBook.profile.password</i18n>
				</div>
				<em class="seven cell">
					<a ng-if="(!me.federated || (me.federated && account.disabledFederatedAdress) || (me.federated && me.hasPw))" ng-click="openPasswordDialog()"><i18n>change.password</i18n></a>
					<a ng-if="(me.federated && !account.disabledFederatedAdress && !me.hasPw)" target="_blank" ng-href="[[account.federatedAddress]]"><i18n>change.password</i18n></a>
				</em>
			</div>

			<div class="row" ng-if="displayOTP(account,me)">
				<div class="four cell">
					<i18n>directory.profile.otp</i18n>
				</div>
				<em class="seven cell">
					<a ng-click="openOTPDialog()"><i18n>directory.generate.otp</i18n></a>
				</em>
			</div>

			<div class="row">
				<label class="four cell"><i18n>userBook.profile.email</i18n></label>
				<div class="one cell">
					<svg ng-init="seeOrHide = (account.visible.email === 'public' ? 'see' : 'hide')"
						 ng-class="[account.visible.email, 'icon-'+seeOrHide]"
						 data-ng-click="changeInfosVisibility('email', account.visible.email)" width="18" height="18">
						<title>[[translate(account.visible.email)]]</title>
						<use href="/directory/public/assets/icons/icons.svg#[[seeOrHide]]"></use>
					</svg>
				</div>
				<em class="seven cell">
					[[account.email]]
					<a ng-click="openEditLightbox('email')">
						<i18n>directory.login.update.button</i18n>
					</a>
				</em>
			</div>

			<div class="row" ng-if="!hidePersonalData">
				<label class="four cell"><i18n>userBook.profile.telephone</i18n></label>
				<div class="one cell">
					<svg ng-init="seeOrHide = (account.visible.phone === 'public' ? 'see' : 'hide')"
						 ng-class="[account.visible.phone, 'icon-'+seeOrHide]"
						 data-ng-click="changeInfosVisibility('phone', account.visible.phone)" width="18" height="18">
						<title>[[translate(account.visible.phone)]]</title>
						<use href="/directory/public/assets/icons/icons.svg#[[seeOrHide]]"></use>
					</svg>
				</div>
				<div class="seven cell">
					<label>[[account.homePhone]]</label>
					<a class="left-spacing-twice" ng-if="account.homePhone" ng-click="openEditLightbox('homePhone')">
						<i18n>directory.login.update.button</i18n>
					</a>
					<a ng-class="{'margin-left': !account.homePhone}" ng-if="!account.homePhone" ng-click="openEditLightbox('homePhone')">
						<i18n>directory.add</i18n>
					</a>
				</div>
			</div>

			<div class="row" ng-if="!hidePersonalData">
				<label class="four cell"><i18n>userBook.profile.mobilePhone</i18n></label>
				<div class="one cell">
					<svg ng-init="seeOrHide = (account.visible.mobile === 'public' ? 'see' : 'hide')"
						 ng-class="[account.visible.mobile, 'icon-'+seeOrHide]"
						 data-ng-click="changeInfosVisibility('mobile', account.visible.mobile)" width="18" height="18">
						<title>[[translate(account.visible.mobile)]]</title>
						<use href="/directory/public/assets/icons/icons.svg#[[seeOrHide]]"></use>
					</svg>
				</div>
				<div class="seven cell">
					<label>[[account.mobile]]</label>
					<a class="left-spacing-twice" ng-if="account.mobile" ng-click="openEditLightbox('mobile')">
						<i18n>directory.login.update.button</i18n>
					</a>
					<a ng-class="{'margin-left': !account.mobile}" ng-if="!account.mobile" ng-click="openEditLightbox('mobile')">
						<i18n>directory.add</i18n>
					</a>
				</div>
			</div>

			<!--div class="row">
				<div class="five cell"><label translate content="userBook.profile.address"></label></div>
				<em class="six cell">[[account.address]]</em>
				<i class="[[account.visible.mail]] right-magnet" title="[[translate(account.visible.mail)]]" data-ng-click="changeInfosVisibility('mail', account.visible.mail)"></i>
			</div-->

			<div class="row">
				<div class="four cell"><i18n>userBook.profile.birthdate</i18n></div>
				<div class="one cell">
					<svg ng-init="seeOrHide = (account.visible.birthDate === 'public' ? 'see' : 'hide')"
						 ng-class="[account.visible.birthDate, 'icon-'+seeOrHide]"
						 data-ng-click="changeInfosVisibility('birthDate', account.visible.birthDate)" width="18" height="18">
						<title>[[translate(account.visible.mobile)]]</title>
						<use href="/directory/public/assets/icons/icons.svg#[[seeOrHide]]"></use>
					</svg>
				</div>
				<em class="seven cell">[[birthDate(account.birthDate)]]</em>
			</div>

			<div class="row">
				<div class="four cell">
					<i18n>userBook.profile.school</i18n>
				</div>
				<em class="seven cell">[[account.schoolName]]</em>
			</div>

		</form>
	</article>
</div>
